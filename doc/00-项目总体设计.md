# 百科Web应用 - 项目总体设计文档

## 1. 项目概述

### 1.1 项目背景
本项目旨在构建一个类似萌娘百科（https://zh.moegirl.org.cn/）的在线百科平台，支持用户创建、编辑、管理百科条目，并提供完善的社区功能。

### 1.2 核心功能
- **用户系统**: 注册、登录、个人资料管理、权限管理
- **文章系统**: 创建、编辑、版本控制、发布、归档
- **分类标签**: 多级分类、标签管理、分类导航
- **评论系统**: 多级评论、点赞、回复通知
- **内容审核**: 审核流程、操作日志、内容管理
- **搜索功能**: 全文搜索、搜索历史、热门搜索
- **文件管理**: 图片上传、文件存储、使用统计
- **通知系统**: 站内通知、消息推送
- **社交功能**: 用户关注、动态展示

### 1.3 技术选型

#### 前端技术栈
- **框架**: Vue 3.x (Composition API)
- **构建工具**: Vite
- **UI框架**: Element Plus / Ant Design Vue
- **状态管理**: Pinia
- **路由**: Vue Router
- **HTTP客户端**: Axios
- **Markdown编辑器**: @toast-ui/vue-editor 或 vditor
- **样式**: SCSS / Tailwind CSS

#### 后端技术栈
- **语言**: Go 1.21+
- **Web框架**: Gin / Echo
- **ORM**: GORM
- **数据库**: PostgreSQL 15+
- **缓存**: Redis 7+
- **认证**: JWT
- **文件存储**: 本地存储 + 对象存储（可选）
- **全文搜索**: PostgreSQL Full-Text Search / Elasticsearch（可选）

#### 基础设施
- **容器化**: Docker + Docker Compose
- **反向代理**: Nginx
- **CI/CD**: GitHub Actions / GitLab CI
- **监控**: Prometheus + Grafana（可选）
- **日志**: ELK Stack（可选）

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────┐
│   用户浏览器     │
└────────┬────────┘
         │ HTTPS
         ▼
┌─────────────────┐
│   Nginx反向代理  │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌────────┐
│ Vue前端 │ │ Go后端 │
│ (静态)  │ │ (API)  │
└────────┘ └────┬───┘
                │
        ┌───────┴───────┐
        │               │
        ▼               ▼
   ┌─────────┐    ┌─────────┐
   │PostgreSQL│    │  Redis  │
   │  (主库)  │    │  (缓存) │
   └─────────┘    └─────────┘
```

### 2.2 模块划分

#### 前端模块
- `src/components/` - 公共组件
- `src/views/` - 页面视图
- `src/stores/` - 状态管理
- `src/api/` - API接口封装
- `src/utils/` - 工具函数
- `src/router/` - 路由配置
- `src/assets/` - 静态资源

#### 后端模块
- `cmd/api/` - 应用入口
- `internal/handler/` - HTTP处理器
- `internal/service/` - 业务逻辑
- `internal/repository/` - 数据访问层
- `internal/model/` - 数据模型
- `internal/middleware/` - 中间件
- `internal/config/` - 配置管理
- `pkg/` - 公共包

## 3. 核心业务流程

### 3.1 用户注册登录流程
1. 用户填写注册信息（用户名、邮箱、密码）
2. 后端验证信息并创建用户
3. 发送邮箱验证（可选）
4. 用户登录，后端生成JWT Token
5. 前端存储Token，后续请求携带Token

### 3.2 文章创建编辑流程
1. 用户创建新文章或编辑现有文章
2. 使用Markdown编辑器编写内容
3. 保存草稿或提交审核
4. 系统创建版本记录
5. 审核通过后发布
6. 更新文章统计信息

### 3.3 评论流程
1. 用户查看文章
2. 发表评论或回复
3. 系统创建评论记录
4. 通知相关用户（文章作者、被回复者）
5. 更新评论计数

### 3.4 内容审核流程
1. 用户提交内容（文章/评论）
2. 系统根据规则自动审核或标记待审核
3. 管理员审核内容
4. 通过/拒绝/修改
5. 记录审核日志
6. 通知用户审核结果

## 4. 安全设计

### 4.1 认证授权
- JWT Token认证
- Token刷新机制
- 基于角色的访问控制（RBAC）
- API接口权限验证

### 4.2 数据安全
- 密码bcrypt加密
- SQL注入防护（参数化查询）
- XSS防护（内容转义）
- CSRF防护（Token验证）
- 文件上传安全（类型、大小限制）

### 4.3 接口安全
- Rate Limiting（限流）
- IP白名单/黑名单
- 敏感操作二次验证
- 操作日志记录

## 5. 性能优化

### 5.1 前端优化
- 代码分割和懒加载
- 图片懒加载和压缩
- 静态资源CDN
- 浏览器缓存策略

### 5.2 后端优化
- 数据库查询优化（索引、分页）
- Redis缓存热点数据
- 连接池管理
- 异步任务处理

### 5.3 数据库优化
- 合理的索引设计
- 查询优化
- 读写分离（扩展）
- 分库分表（扩展）

## 6. 部署架构

### 6.1 开发环境
- Docker Compose本地部署
- 热重载开发
- 本地数据库和Redis

### 6.2 生产环境
- Docker容器化部署
- Nginx反向代理和负载均衡
- PostgreSQL主从复制（可选）
- Redis集群（可选）
- 对象存储服务（可选）

## 7. 项目结构

```
dbapp/
├── doc/                    # 文档目录
│   ├── 00-项目总体设计.md
│   ├── 01-数据库设计.md
│   ├── 02-系统架构设计.md
│   ├── 03-API接口设计.md
│   ├── 04-前端架构设计.md
│   ├── 05-后端架构设计.md
│   └── 06-容器化部署指南.md
├── frontend/               # 前端项目
│   ├── src/
│   ├── public/
│   ├── package.json
│   └── vite.config.js
├── backend/                # 后端项目
│   ├── cmd/
│   ├── internal/
│   ├── pkg/
│   ├── go.mod
│   └── go.sum
├── docker/                 # Docker相关文件
│   ├── Dockerfile.frontend
│   ├── Dockerfile.backend
│   └── docker-compose.yml
├── nginx/                  # Nginx配置
│   └── nginx.conf
└── README.md
```

## 8. 开发计划

### 阶段一：基础框架搭建
- 项目初始化
- 数据库设计和迁移
- 基础API框架
- 前端项目搭建

### 阶段二：核心功能开发
- 用户系统
- 文章系统
- 分类标签系统
- 评论系统

### 阶段三：高级功能开发
- 搜索功能
- 通知系统
- 内容审核
- 文件管理

### 阶段四：优化和部署
- 性能优化
- 安全加固
- 容器化部署
- 文档完善

## 9. 参考资料

- 萌娘百科: https://zh.moegirl.org.cn/
- Vue 3 文档: https://cn.vuejs.org/
- Go 官方文档: https://go.dev/doc/
- PostgreSQL 文档: https://www.postgresql.org/docs/
- Docker 文档: https://docs.docker.com/

