# 百科Web应用 - 前端架构设计文档

## 1. 技术栈

### 1.1 核心框架
- **Vue 3.3+**: 使用Composition API
- **TypeScript**: 类型安全
- **Vite 5+**: 构建工具
- **Vue Router 4+**: 路由管理
- **Pinia 2+**: 状态管理

### 1.2 UI框架
- **Element Plus**: 主要UI组件库
- **@element-plus/icons-vue**: 图标库
- **SCSS**: 样式预处理器

### 1.3 工具库
- **Axios**: HTTP客户端
- **dayjs**: 日期处理
- **marked**: Markdown解析
- **highlight.js**: 代码高亮
- **@vueuse/core**: Vue组合式工具库

### 1.4 编辑器
- **@toast-ui/vue-editor**: Markdown编辑器
- 或 **vditor**: 富文本编辑器

## 2. 项目结构

```
frontend/
├── public/                 # 静态资源
│   ├── favicon.ico
│   └── index.html
├── src/
│   ├── api/                # API接口
│   │   ├── request.ts      # Axios配置
│   │   ├── types.ts        # API类型定义
│   │   ├── auth.ts         # 认证相关
│   │   ├── user.ts         # 用户相关
│   │   ├── article.ts      # 文章相关
│   │   ├── comment.ts      # 评论相关
│   │   ├── category.ts     # 分类相关
│   │   ├── tag.ts          # 标签相关
│   │   ├── file.ts         # 文件相关
│   │   ├── search.ts       # 搜索相关
│   │   └── notification.ts # 通知相关
│   ├── assets/             # 资源文件
│   │   ├── images/
│   │   ├── styles/
│   │   └── fonts/
│   ├── components/         # 组件
│   │   ├── common/         # 通用组件
│   │   │   ├── Header.vue
│   │   │   ├── Footer.vue
│   │   │   ├── Sidebar.vue
│   │   │   ├── Pagination.vue
│   │   │   ├── Loading.vue
│   │   │   └── Empty.vue
│   │   ├── article/        # 文章相关组件
│   │   │   ├── ArticleCard.vue
│   │   │   ├── ArticleList.vue
│   │   │   ├── ArticleDetail.vue
│   │   │   ├── ArticleEditor.vue
│   │   │   └── ArticleMeta.vue
│   │   ├── comment/        # 评论相关组件
│   │   │   ├── CommentList.vue
│   │   │   ├── CommentItem.vue
│   │   │   ├── CommentEditor.vue
│   │   │   └── CommentReply.vue
│   │   └── user/           # 用户相关组件
│   │       ├── UserCard.vue
│   │       ├── UserProfile.vue
│   │       └── UserAvatar.vue
│   ├── composables/        # 组合式函数
│   │   ├── useAuth.ts
│   │   ├── useArticle.ts
│   │   ├── useComment.ts
│   │   ├── usePagination.ts
│   │   └── useUpload.ts
│   ├── directives/         # 自定义指令
│   │   ├── loading.ts
│   │   └── permission.ts
│   ├── router/             # 路由配置
│   │   ├── index.ts
│   │   ├── routes.ts
│   │   └── guards.ts
│   ├── stores/             # Pinia状态管理
│   │   ├── index.ts
│   │   ├── user.ts
│   │   ├── article.ts
│   │   ├── comment.ts
│   │   └── app.ts
│   ├── utils/              # 工具函数
│   │   ├── auth.ts         # 认证工具
│   │   ├── storage.ts      # 存储工具
│   │   ├── format.ts       # 格式化工具
│   │   ├── validate.ts     # 验证工具
│   │   ├── request.ts      # 请求工具
│   │   └── constants.ts    # 常量定义
│   ├── views/              # 页面视图
│   │   ├── Home.vue        # 首页
│   │   ├── Article/        # 文章相关页面
│   │   │   ├── Index.vue   # 文章列表
│   │   │   ├── Detail.vue  # 文章详情
│   │   │   ├── Create.vue  # 创建文章
│   │   │   └── Edit.vue    # 编辑文章
│   │   ├── Category/       # 分类页面
│   │   │   └── Index.vue
│   │   ├── Tag/            # 标签页面
│   │   │   └── Index.vue
│   │   ├── User/           # 用户相关页面
│   │   │   ├── Profile.vue # 个人资料
│   │   │   ├── Articles.vue
│   │   │   └── Settings.vue
│   │   ├── Search/         # 搜索页面
│   │   │   └── Index.vue
│   │   ├── Auth/           # 认证页面
│   │   │   ├── Login.vue
│   │   │   └── Register.vue
│   │   └── Admin/          # 管理后台
│   │       ├── Dashboard.vue
│   │       ├── Articles.vue
│   │       ├── Users.vue
│   │       └── Settings.vue
│   ├── App.vue             # 根组件
│   └── main.ts             # 入口文件
├── .env                    # 环境变量
├── .env.development
├── .env.production
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
└── README.md
```

## 3. 核心模块设计

### 3.1 API模块

#### 3.1.1 Axios配置 (src/api/request.ts)
```typescript
import axios from 'axios'
import { useUserStore } from '@/stores/user'
import { ElMessage } from 'element-plus'
import router from '@/router'

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000
})

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const userStore = useUserStore()
    if (userStore.token) {
      config.headers.Authorization = `Bearer ${userStore.token}`
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  (response) => {
    const { code, data, message } = response.data
    if (code === 200) {
      return data
    } else {
      ElMessage.error(message || '请求失败')
      return Promise.reject(new Error(message))
    }
  },
  (error) => {
    if (error.response?.status === 401) {
      // Token过期，跳转登录
      const userStore = useUserStore()
      userStore.logout()
      router.push('/login')
    }
    ElMessage.error(error.response?.data?.message || '网络错误')
    return Promise.reject(error)
  }
)

export default request
```

#### 3.1.2 API接口封装示例 (src/api/article.ts)
```typescript
import request from './request'
import type { Article, ArticleListParams, Pagination } from './types'

// 获取文章列表
export function getArticleList(params: ArticleListParams) {
  return request.get<{ items: Article[]; pagination: Pagination }>('/articles', { params })
}

// 获取文章详情
export function getArticleDetail(id: number) {
  return request.get<Article>(`/articles/${id}`)
}

// 创建文章
export function createArticle(data: Partial<Article>) {
  return request.post<Article>('/articles', data)
}

// 更新文章
export function updateArticle(id: number, data: Partial<Article>) {
  return request.put<Article>(`/articles/${id}`, data)
}

// 删除文章
export function deleteArticle(id: number) {
  return request.delete(`/articles/${id}`)
}

// 点赞文章
export function likeArticle(id: number) {
  return request.post(`/articles/${id}/like`)
}

// 取消点赞
export function unlikeArticle(id: number) {
  return request.delete(`/articles/${id}/like`)
}
```

### 3.2 状态管理 (Pinia)

#### 3.2.1 用户Store (src/stores/user.ts)
```typescript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { login, getCurrentUser } from '@/api/auth'
import { getToken, setToken, removeToken } from '@/utils/auth'

export const useUserStore = defineStore('user', () => {
  const token = ref<string>(getToken() || '')
  const userInfo = ref<User | null>(null)

  const isLoggedIn = computed(() => !!token.value)
  const isAdmin = computed(() => userInfo.value?.role === 'admin')

  async function loginAction(username: string, password: string) {
    const { token: newToken, user } = await login({ username, password })
    token.value = newToken
    userInfo.value = user
    setToken(newToken)
  }

  async function fetchUserInfo() {
    if (!token.value) return
    userInfo.value = await getCurrentUser()
  }

  function logout() {
    token.value = ''
    userInfo.value = null
    removeToken()
  }

  return {
    token,
    userInfo,
    isLoggedIn,
    isAdmin,
    loginAction,
    fetchUserInfo,
    logout
  }
})
```

#### 3.2.2 文章Store (src/stores/article.ts)
```typescript
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { getArticleList, getArticleDetail } from '@/api/article'
import type { Article, ArticleListParams } from '@/api/types'

export const useArticleStore = defineStore('article', () => {
  const articles = ref<Article[]>([])
  const currentArticle = ref<Article | null>(null)
  const pagination = ref({
    page: 1,
    page_size: 20,
    total: 0,
    total_pages: 0
  })

  async function fetchArticles(params: ArticleListParams) {
    const { items, pagination: pag } = await getArticleList(params)
    articles.value = items
    pagination.value = pag
  }

  async function fetchArticleDetail(id: number) {
    currentArticle.value = await getArticleDetail(id)
  }

  return {
    articles,
    currentArticle,
    pagination,
    fetchArticles,
    fetchArticleDetail
  }
})
```

### 3.3 路由设计

#### 3.3.1 路由配置 (src/router/routes.ts)
```typescript
import type { RouteRecordRaw } from 'vue-router'

export const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Home',
    component: () => import('@/views/Home.vue')
  },
  {
    path: '/article',
    children: [
      {
        path: '',
        name: 'ArticleList',
        component: () => import('@/views/Article/Index.vue')
      },
      {
        path: ':id',
        name: 'ArticleDetail',
        component: () => import('@/views/Article/Detail.vue')
      },
      {
        path: 'new',
        name: 'ArticleCreate',
        component: () => import('@/views/Article/Create.vue'),
        meta: { requiresAuth: true }
      },
      {
        path: ':id/edit',
        name: 'ArticleEdit',
        component: () => import('@/views/Article/Edit.vue'),
        meta: { requiresAuth: true }
      }
    ]
  },
  {
    path: '/category/:slug',
    name: 'Category',
    component: () => import('@/views/Category/Index.vue')
  },
  {
    path: '/tag/:slug',
    name: 'Tag',
    component: () => import('@/views/Tag/Index.vue')
  },
  {
    path: '/user/:id',
    name: 'UserProfile',
    component: () => import('@/views/User/Profile.vue')
  },
  {
    path: '/search',
    name: 'Search',
    component: () => import('@/views/Search/Index.vue')
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/Auth/Login.vue'),
    meta: { guestOnly: true }
  },
  {
    path: '/register',
    name: 'Register',
    component: () => import('@/views/Auth/Register.vue'),
    meta: { guestOnly: true }
  },
  {
    path: '/admin',
    name: 'Admin',
    component: () => import('@/views/Admin/Dashboard.vue'),
    meta: { requiresAuth: true, requiresAdmin: true }
  }
]
```

#### 3.3.2 路由守卫 (src/router/guards.ts)
```typescript
import { Router } from 'vue-router'
import { useUserStore } from '@/stores/user'

export function setupRouterGuards(router: Router) {
  router.beforeEach((to, from, next) => {
    const userStore = useUserStore()

    // 需要登录
    if (to.meta.requiresAuth && !userStore.isLoggedIn) {
      next({ name: 'Login', query: { redirect: to.fullPath } })
      return
    }

    // 仅游客访问
    if (to.meta.guestOnly && userStore.isLoggedIn) {
      next({ name: 'Home' })
      return
    }

    // 需要管理员权限
    if (to.meta.requiresAdmin && !userStore.isAdmin) {
      next({ name: 'Home' })
      return
    }

    next()
  })
}
```

### 3.4 组合式函数 (Composables)

#### 3.4.1 usePagination (src/composables/usePagination.ts)
```typescript
import { ref, computed } from 'vue'

export function usePagination(initialPageSize = 20) {
  const page = ref(1)
  const pageSize = ref(initialPageSize)
  const total = ref(0)

  const totalPages = computed(() => Math.ceil(total.value / pageSize.value))

  function reset() {
    page.value = 1
    total.value = 0
  }

  function setPage(newPage: number) {
    page.value = newPage
  }

  return {
    page,
    pageSize,
    total,
    totalPages,
    reset,
    setPage
  }
}
```

#### 3.4.2 useUpload (src/composables/useUpload.ts)
```typescript
import { ref } from 'vue'
import { uploadFile } from '@/api/file'
import { ElMessage } from 'element-plus'

export function useUpload() {
  const uploading = ref(false)
  const uploadProgress = ref(0)

  async function upload(file: File, fileType: string) {
    uploading.value = true
    uploadProgress.value = 0

    try {
      const formData = new FormData()
      formData.append('file', file)
      formData.append('file_type', fileType)

      const result = await uploadFile(formData, {
        onUploadProgress: (progressEvent) => {
          if (progressEvent.total) {
            uploadProgress.value = Math.round(
              (progressEvent.loaded * 100) / progressEvent.total
            )
          }
        }
      })

      ElMessage.success('上传成功')
      return result
    } catch (error) {
      ElMessage.error('上传失败')
      throw error
    } finally {
      uploading.value = false
      uploadProgress.value = 0
    }
  }

  return {
    uploading,
    uploadProgress,
    upload
  }
}
```

### 3.5 工具函数

#### 3.5.1 认证工具 (src/utils/auth.ts)
```typescript
const TOKEN_KEY = 'token'
const REFRESH_TOKEN_KEY = 'refresh_token'

export function getToken(): string | null {
  return localStorage.getItem(TOKEN_KEY)
}

export function setToken(token: string): void {
  localStorage.setItem(TOKEN_KEY, token)
}

export function removeToken(): void {
  localStorage.removeItem(TOKEN_KEY)
  localStorage.removeItem(REFRESH_TOKEN_KEY)
}
```

#### 3.5.2 格式化工具 (src/utils/format.ts)
```typescript
import dayjs from 'dayjs'
import relativeTime from 'dayjs/plugin/relativeTime'
import 'dayjs/locale/zh-cn'

dayjs.extend(relativeTime)
dayjs.locale('zh-cn')

// 相对时间
export function formatRelativeTime(date: string | Date): string {
  return dayjs(date).fromNow()
}

// 格式化日期
export function formatDate(date: string | Date, format = 'YYYY-MM-DD HH:mm:ss'): string {
  return dayjs(date).format(format)
}

// 格式化数字
export function formatNumber(num: number): string {
  if (num >= 10000) {
    return (num / 10000).toFixed(1) + '万'
  }
  return num.toString()
}
```

## 4. 组件设计

### 4.1 文章卡片组件 (src/components/article/ArticleCard.vue)
```vue
<template>
  <el-card class="article-card" @click="goToDetail">
    <template #header>
      <div class="article-header">
        <h3 class="article-title">{{ article.title }}</h3>
        <el-tag v-if="article.is_featured" type="warning">精选</el-tag>
      </div>
    </template>
    <div class="article-content">
      <p class="article-summary">{{ article.summary }}</p>
      <div class="article-meta">
        <UserAvatar :user="article.author" />
        <span class="meta-item">
          <el-icon><View /></el-icon>
          {{ formatNumber(article.view_count) }}
        </span>
        <span class="meta-item">
          <el-icon><Like /></el-icon>
          {{ formatNumber(article.like_count) }}
        </span>
        <span class="meta-item">
          <el-icon><ChatDotRound /></el-icon>
          {{ formatNumber(article.comment_count) }}
        </span>
        <span class="meta-item">{{ formatRelativeTime(article.created_at) }}</span>
      </div>
    </div>
  </el-card>
</template>

<script setup lang="ts">
import { useRouter } from 'vue-router'
import { formatRelativeTime, formatNumber } from '@/utils/format'
import UserAvatar from '@/components/user/UserAvatar.vue'
import type { Article } from '@/api/types'

const props = defineProps<{
  article: Article
}>()

const router = useRouter()

function goToDetail() {
  router.push(`/article/${props.article.id}`)
}
</script>
```

### 4.2 评论列表组件 (src/components/comment/CommentList.vue)
```vue
<template>
  <div class="comment-list">
    <CommentItem
      v-for="comment in comments"
      :key="comment.id"
      :comment="comment"
      @reply="handleReply"
    />
    <el-pagination
      v-if="pagination.total_pages > 1"
      v-model:current-page="pagination.page"
      :page-size="pagination.page_size"
      :total="pagination.total"
      layout="prev, pager, next"
      @current-change="handlePageChange"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import CommentItem from './CommentItem.vue'
import { getCommentList } from '@/api/comment'
import type { Comment, Pagination } from '@/api/types'

const props = defineProps<{
  articleId: number
}>()

const comments = ref<Comment[]>([])
const pagination = ref<Pagination>({
  page: 1,
  page_size: 20,
  total: 0,
  total_pages: 0
})

async function fetchComments() {
  const { items, pagination: pag } = await getCommentList(props.articleId, {
    page: pagination.value.page,
    page_size: pagination.value.page_size
  })
  comments.value = items
  pagination.value = pag
}

function handlePageChange(page: number) {
  pagination.value.page = page
  fetchComments()
}

function handleReply(comment: Comment) {
  // 处理回复逻辑
}

fetchComments()
</script>
```

## 5. 样式设计

### 5.1 全局样式 (src/assets/styles/main.scss)
```scss
// 变量定义
$primary-color: #409eff;
$success-color: #67c23a;
$warning-color: #e6a23c;
$danger-color: #f56c6c;
$info-color: #909399;

// 全局样式
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  color: #333;
  background-color: #f5f5f5;
}

// 工具类
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.text-center {
  text-align: center;
}

.mt-20 {
  margin-top: 20px;
}
```

## 6. 性能优化

### 6.1 代码分割
- 路由懒加载
- 组件懒加载
- 第三方库按需加载

### 6.2 资源优化
- 图片懒加载
- 图片压缩
- 静态资源CDN

### 6.3 缓存策略
- API响应缓存
- 组件缓存
- 浏览器缓存

## 7. 构建配置

### 7.1 Vite配置 (vite.config.ts)
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    chunkSizeWarningLimit: 1000,
    rollupOptions: {
      output: {
        manualChunks: {
          'element-plus': ['element-plus'],
          'vue-vendor': ['vue', 'vue-router', 'pinia']
        }
      }
    }
  }
})
```

### 7.2 环境变量 (.env.development)
```
VITE_API_BASE_URL=http://localhost:8080/api/v1
VITE_APP_TITLE=百科Web应用
```

## 8. 开发规范

### 8.1 代码规范
- 使用ESLint + Prettier
- 使用TypeScript严格模式
- 组件命名使用PascalCase
- 文件命名使用kebab-case

### 8.2 Git规范
- 提交信息使用约定式提交
- 分支命名: feature/xxx, fix/xxx, hotfix/xxx

### 8.3 组件规范
- 单一职责原则
- 可复用性
- Props类型定义
- 事件命名规范

